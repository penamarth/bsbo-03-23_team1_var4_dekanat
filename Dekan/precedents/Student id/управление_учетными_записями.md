Рамки. Информационная система деканата (ИС деканата).

Уровень. Задача, определенная пользователем.

Основной исполнитель. Администратор системы.

Заинтересованные лица и их требования.
- Администратор системы. Хочет безопасно и удобно создавать, изменять и удалять роли, а также назначать их пользователям.
- Сотрудники деканата/Преподаватели/Студенты. Ожидают корректных прав доступа в соответствии с ролью; минимизация рисков избыточных прав.
- Служба авторизации (SSO/IdP). Хочет получать запросы на аннулирование сессий и изменения авторизационной информации в корректном формате и с минимальными задержками.
- Служба информационной безопасности и аудит. Требует полноты и неизменяемости журналов аудита всех операций с ролями и назначениями.
- Руководство факультета/вуза. Хочет прозрачного разграничения доступа и соответствия нормативным требованиям.
- Эксплуатирующая ИТ-служба. Хочет четких инвариантов данных (уникальность имен ролей, целостность связей), отказоустойчивости и наблюдаемости.

Предусловия.
- Администратор аутентифицирован и обладает правами «Администратор».
- Справочник разрешений (Permission) определён и доступен.
- Система подключена к Службе авторизации для аннулирования сессий.

Результаты (Постусловия) — гарантии при успешном завершении.
- Создана/обновлена/удалена роль в системе с корректными связями «роль–разрешение».
- Назначения ролей пользователям созданы/удалены согласно запросам.
- Активные сессии затронутых пользователей аннулированы при изменении их назначений.
- Все операции отражены в журнале аудита с атрибутами «кто/когда/что».

Основной успешный сценарий (пример: создание роли и её назначение пользователю).
1. Администратор инициирует «Управление ролями».
2. Система запрашивает аутентификацию и подтверждает права администратора.
3. Администратор создаёт роль, указывая имя и набор разрешений.
4. Система проверяет уникальность имени роли, создаёт роль и привязывает выбранные разрешения.
5. Администратор назначает созданную роль выбранному пользователю.
6. Система создаёт назначение, аннулирует активные сессии пользователя в Службе авторизации.
7. Система фиксирует операции в журнале аудита и подтверждает выполнение администратору.

Расширения (альтернативные потоки).
1а. Недостаточно прав администратора.
1. Система отклоняет запрос и сообщает об отсутствии прав.
   3а. Попытка создания роли с уже существующим именем.
1. Система сообщает об ошибке «Роль с таким именем уже существует».
   4а. Указанные разрешения частично не найдены.
1. Система сообщает о некорректных разрешениях и не выполняет создание/изменение.
   5а. Пользователь или роль не найдены при назначении.
1. Система сообщает об ошибке и не создаёт назначение.
   5б. Роль уже назначена пользователю.
1. Система сообщает, что назначение уже существует (операция идемпотентна).
   Удаление роли:
- Если у роли есть активные назначения пользователям, система запрещает удаление и сообщает количество назначений.
  Сбой внешней Службы авторизации при аннулировании сессий:
- Система регистрирует сбой, возвращает частичный успех с указанием на задержанное аннулирование, повторяет попытку по политике ретраев/очереди.

Специальные требования.
- Аудит: неизменяемые журналы с детализацией (операция, субъект, объект, прежние/новые значения, время, источник).
- Производительность: 95-й перцентиль времени операций < 500 мс (без учёта внешнего IdP); аннулирование сессий — асинхронно, SLA 99% < 2 с.
- Безопасность: валидация входных данных, защита от эскалации привилегий, ограничение системных ролей (например, «Администратор» — не удаляемая, не переименуемая).
- Локализация интерфейса и сообщений об ошибках.
- Консистентность: атомарность изменений роли и её разрешений; транзакционность операций в БД.

Список технологий и типов данных (вариации).
- Идентификаторы: RoleID/UserID — UUID, PermissionCode — строковый код (snake_case).
- Интеграция с IdP/SSO: REST/JSON, OAuth2/OIDC; аннулирование сессий по userId/subject.
- Хранилище: реляционная БД; таблицы Role, Permission, RolePermission, UserRole; уникальный индекс на role.name.

Частота использования.
- Нерегулярно; всплески при вводе новой версии регламента доступа, внедрении модулей.

Открытые вопросы.
- Политика «мягкого» удаления ролей (soft delete) vs «жёсткого» удаления.
- Модель разрешений: гранулярность (ресурс/действие/условия), необходимость иерархий ролей.
- Нужны ли нотификации пользователям о смене роли.
- Срок хранения и формат экспортов журналов аудита.